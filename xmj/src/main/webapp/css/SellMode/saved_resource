KISSY.add("tbc/search-suggest/1.4.7/plugin/tab",function(t,a,o,e,r){function s(t){s.superclass.constructor.call(this,t||{})}return t.extend(s,a,{pluginInitializer:function(t){this.tabConfig={},this._initPluginEvent.call(this,t)},tabClick:function(a){var e,r,s=this,i=s.get("caller"),c=a.currentTarget,n=o.attr(c,"data-searchtype"),l=o.attr(c,"data-defaultpage"),g=o.attr(c,"data-action"),u=i.comboBox.get("input"),f=o.parent(u,"form"),b=s.get("activeCls"),d=o.get("label",f),C=s.tabConfig;if(i.fire("beforeTabChange",{el:c,labelType:n})===!1)return!1;if(o.removeClass(o.siblings(c),b),o.addClass(c,b),i.tabNode=t.one(c),l&&f.setAttribute("data-defaultpage",l),g&&f.setAttribute("action",g),n){if(r=C[n]||s.getDefCfg(n),!r)return!1;g&&(r.action=g),i.update(r),s.tabConfig&&!s.tabConfig[n]&&s.saveTabConfig(r)}else{var m=i.query||u.val(),h=o.get("a",c);if(h){var p=o.attr(h,"href");p=p.replace("/?","/search?"),p=p+"&q="+m,o.attr(h,"href",p)}}d&&(e=d.getAttribute("data-searchtype-"+n)||"",d.innerHTML=e),a.preventDefault()},_initPluginEvent:function(a){var o=this,r=o.get("activeCls"),s=o.get("node")||a.get("sugConfig").tablist;o.set("caller",a),s&&(e.on(s,"click",o.tabClick,o),t.all(s).each(function(t,o){t.hasClass(r)&&(a.tabNode=t)}),o.saveTabConfig())},saveTabConfig:function(a){var o,e,r=this,s=r.get("caller"),i=s.get("form");o=s.tabNode.attr("data-searchtype"),e=s.userConfig||{},e.mods=s.get("mods"),e.tab=o,e.action=i.attr("action"),e.defaultpage=i.attr("data-defaultpage"),r.tabConfig||(r.tabConfig={}),r.tabConfig[o]=t.clone(e),a&&a.sugConfig&&a.sugConfig.sourceUrl&&r.tabConfig[o].sugConfig&&(r.tabConfig[o].sugConfig.sourceUrl=a.sugConfig.sourceUrl,r.tabConfig[o].tab=o)},update:function(t){var a,e,s,i=this,c=i.get("caller"),n=c.comboBox,l=t.tab,g=c.configArr[l],u=t.sugConfig,f=n.get("input"),b=o.parent(f,"form");c.configArr=c.configArr||[],e=c.get("dataSourceCfg"),s=e.xhrCfg,s.url=u.sourceUrl,c.__attrVals.mods.sort=t.mods.sort,g||(g=c.configArr[l]=""===s.url?{data:new r.LocalDataSource({data:{},parse:e.parse})}:{data:new r.RemoteDataSource(e)}),a=g.data,n.set("maxItemCount",s.url?10:0),n.set("dataSource",g.data),b&&o.attr(b,"action",t.action),f[0].focus();var d=f.val();d&&n.sendRequest(d)},getDefCfg:function(a){var o;switch(a){case"shop":o={sugConfig:{sourceUrl:location.protocol+"//suggest.taobao.com/sug?area=ssrch&k=1",resultFormat:"",tab:"shop",excludeParam:["q"]},mods:{sort:["history","list"],showExtra:!1},action:location.protocol+"//shopsearch.taobao.com/search",tab:"shop"};break;case"item":o={sugConfig:{sourceUrl:location.protocol+"//suggest.taobao.com/sug?area=c2c&k=1",resultFormat:"",tab:"item",excludeParam:["q"]},mods:{sort:["history","cat","global","list","shop"]},tab:"item",action:location.protocol+"//s.taobao.com/search"};break;case"mall":o={sugConfig:{sourceUrl:location.protocol+"//suggest.taobao.com/sug?area=b2c&k=1",resultFormat:"",tab:"mall",excludeParam:["q"]},mods:{sort:["history","cat","global","list"]},tab:"mall",action:location.protocol+"//list.tmall.com/search_product.htm"};break;default:t.isObject(a)?(o=a,o.sugConfig||(o.sugConfig={})):t.isString(a)&&(o={sugConfig:{sourceUrl:location.protocol+"//suggest.taobao.com/sug?area=c2c&k=1",resultFormat:"",tab:a,excludeParam:["q"]},mods:{sort:["history","list"]},action:null})}return o.sugConfig&&!o.sugConfig.tab&&(o.sugConfig.tab=o.sugConfig.sourceUrl),o}},{ATTRS:{pluginId:{value:"tab"},caller:{value:null}}}),s},{requires:["base","dom","event","combobox"]});