KISSY.add("tbc/search-suggest/1.4.7/suggest",function(e,t){function r(e){r.superclass.constructor.call(this,e||{})}return r=t.extend({initializer:function(){var e=this;e.on("afterRenderData",function(){e.fire("beforeShow")})},sendRequest:function(e){var t=this,r=t.constructor.superclass.sendRequest;if(t.fire("beforeQueryChange",{query:e})===!1)return!1;t.queryTimer&&clearTimeout(t.queryTimer),t.laterTimer&&clearTimeout(t.laterTimer);var n=arguments;t.queryTimer=setTimeout(function(){t.queryTimer=null,t.laterTimer=setTimeout(function(){t.later=!1},500),r.apply(t,n)},t.later?200:50),t.later=!0},handleKeyDownInternal:function(e){var t=this,r=t.constructor.superclass.handleKeyDownInternal;return t.fire("beforeKeyDown",{event:e})===!1?!1:void r.apply(this,arguments)},handleKeyEventInternal:function(e){var t=this,r=t.constructor.superclass.handleKeyEventInternal;return t.fire("beforeKeyDown",{event:e})===!1?!1:void r.apply(this,arguments)},setValueInternal:function(e){var t=this,r=t.constructor.superclass.setValueInternal;return t.fire("beforeSetInputValue",{event:e})===!1?!1:void r.apply(this,arguments)},setValueFromAutocomplete:function(e){var t=this,r=t.constructor.superclass.setValueFromAutocomplete;return t.fire("beforeSetInputValue",{event:e})===!1?!1:void r.apply(this,arguments)},renderItems:function(t,r,n){var a,u,o=this,s=o.get("sugConfig").resultFormat,i=o.resultArr||(o.resultArr=[]),l="",c=t;e.each(r,function(t,o){if(!t||!t[0])return void r.splice(o,1);for(a=t[0];a.indexOf(c)<0;)c=c.substr(0,c.length-1);""===c?(l=a,a=""):0===a.indexOf(c)&&(l=c,a=a.replace(c,""));for(var f in i)if(u=i[f],u.textContent===t[0]&&u.unique)return;n=n.replace("{format}",s),i.push({textContent:t[0],content:e.substitute(n,{query:l,text:a,index:o+1,count:t[1]}),list:!0})}),o.resultArr=i},alignInternal:function(e){var t=this,r=t.constructor.superclass.alignInternal;return t.fire("beforeShow",{event:e})===!1?!1:void r.apply(this,arguments)}},{ATTRS:{dataSourceCfg:{value:{xhrCfg:{url:"",dataType:"jsonp",scriptCharset:"utf-8",data:{code:"utf-8"}},allowEmpty:!0,paramName:"q",cache:!0}},mods:{value:{},setter:function(e){return e}}}}),r.RemoteDataSource=t.RemoteDataSource,r.LocalDataSource=t.LocalDataSource,r},{requires:["combobox"]});KISSY.add("tbc/search-suggest/1.4.7/mods/mods",function(){return{"new":{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-xp" data-key="q={$queryUrl}&suggest=new_{$index}&tab=shopping&auction_tag[]=1154"><span class="{prefixCls}menu-xp-tag">新品</span><span class="{prefixCls}menu-xp-icon">新品</span><span class="{prefixCls}menu-xp">“{$query}”相关{new}新品</span></div>'},shop:{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-dp" data-action="//shopsearch.taobao.com/search" data-key="q={$queryUrl}&suggest=shop_{$index}"><span class="{prefixCls}menu-dp">{$query} <b>相关店铺</b></span><span class="{prefixCls}menu-dp-icon">店铺</span></div>'},cat:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-key="q={$2}&cat={$1}&suggest=cat_{$index}"><span class="{prefixCls}menu-key">{$2}</span><span class="{prefixCls}menu-cate">在<b>{$0}</b>分类下搜索</span></div>'},list:{tmpl:"<div data-index='{index}' class='item-wrapper' data-key='q={textContent}&suggest=0_{index}'><span class='item-text'>{query}<b>{text}</b></span><span class='item-count'>{format}</span></div>"},global:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-key="q={$queryUrl}&promote=2097152&suggest=global_{$index}"><span class="{prefixCls}menu-key">{$query}</span><span class="{prefixCls}menu-cate">在全球购市场中搜索</span></div>'},history:{tmpl:'<div class="{prefixCls}menu-extras-history" {attr} data-key="q={historyItemQuery}&suggest={extraParam}_{index}" data-index="_his_{index}" data-value="{historyItemValue}"><span class="{prefixCls}menu-history-key">{historyItemValue}</span><span data-type="{extraParam}" class="{prefixCls}menu-history-delete">删除</span></div>'},scene:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-scene" data-action="//fa.taobao.com/search" data-key="q={scene}&suggest=scene_{$index}"><span class="{prefixCls}menu-key">{scene}</span><b>装修宝典/选购秘籍</b></div>'},dapei_bottom:{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-dp" data-source-stat="source_click=suggest_kfc&source_pv=suggest_kfc#!Content" data-action="//pose.taobao.com/search" data-key="q={dapei_bottom}"><span class="{prefixCls}menu-dp">{dapei_bottom}<b>全套搭配</b></span></div>'},dapei_top:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-source-stat="source_click=suggest_jqc&source_pv=suggest_jqc#!Content" data-action="//pose.taobao.com/search" data-key="q={dapei_top}"><span class="{prefixCls}menu-key">{dapei_top}</span><span class="{prefixCls}menu-cate">在<b>搭配</b>下搜索</span></div>'},tmall:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-mall" data-key="q={tmall}&suggest=tmall_{$index}&tab=mall"><span class="{prefixCls}menu-key">{tmall}</span><b>天猫相关</b></div>'},c2c_activity:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-active" data-key="q={c2c_activity_query} {c2c_activity_tag}&suggest=active_{$index}&tab=deal"><span class="{prefixCls}menu-key">{c2c_activity_query}</span><span class="{prefixCls}menu-cate">在 <b>{c2c_activity_tag}</b> 中搜索</span></div>'},showExtra:!1}});KISSY.add("tbc/search-suggest/1.4.7/mods/bts",function(t,e,u){function n(t){n.superclass.constructor.call(this,t||{})}return t.extend(n,e,{getBucket:function(){var t=this,e=t.getCookieT(),u=t.getTestBucket()||t.retBucket(e,20,-4,4)-0;return u},getTestBucket:function(){var t=location.search,e=t.match(/alg_bts=(\d+)/);return e&&e[1]?e[1]-0:void 0},getCookieT:function(){var t=new u,e=t.getCookie("t");return e},retBucket:function(t,e,u,n){return!t&&"0"||this.countBucket(t,e,u,n)},countBucket:function(t,e,u,n){var r=t.substr(u,n),c=parseInt(r,16),s=c%e+1;return s+""}},{ATTRS:{pluginId:{value:"bts"}}}),n},{requires:["base","./utils"]});KISSY.add("tbc/search-suggest/1.4.7/mods/utils",function(e,t){function n(e){return i?i:(n.superclass.constructor.call(this,e||{}),void(i=this))}var i;return e.extend(n,t,{pluginInitializer:function(e){var t=this;t.set("caller",e)},getCookie:function(t){var n=window;if(n.userCookie&&!e.isUndefined(n.userCookie[t]))return n.userCookie[t];if(n.SRP_COOKIES||(n.SRP_COOKIES={})&&e.isUndefined(SRP_COOKIES[t])){var i=document.cookie.match("(?:^|;)\\s*"+t+"=([^;]*)");SRP_COOKIES[t]=i&&i[1]?decodeURIComponent(i[1]):""}return SRP_COOKIES[t]},fireEvent:function(e,t){var n=document;if(n.createEvent){var i=n.createEvent("MouseEvents");i.initEvent(t,!0,!1),e.dispatchEvent(i)}else n.createEventObject&&e.fireEvent("on"+t)}},{ATTRS:{pluginId:{value:"utils"}}}),n},{requires:["base"]});KISSY.add("tbc/search-suggest/1.4.7/mods/stat",function(t,e,n,a,i){function r(t){r.superclass.constructor.call(this,t||{})}return t.extend(r,e,{pluginInitializer:function(t){var e=this,n=e.get("stat");e.set("caller",t),t.on("beforeSubmit",function(t){var n=t.isInitSearch;e.setStat(n)}),n&&(e.sendTongji(),e.bindSearchTrace())},bindSearchTrace:function(){var t=this;a.delegate("body","click","a",t.initSearchTrace,t)},initSearchTrace:function(t){var e=this,n=t.currentTarget,a=n.getAttribute("trace"),i=n.getAttribute("href");if(a)switch(a){case"relatedSearch":e.saveQuery();break;case"auction":var r=e.stat;r&&-1===i.indexOf("initiative_new")&&n.setAttribute("href",i+"&initiative_new=1")}},sendTongji:function(){var t,e=this,n=e.getStatInst();n.checkFlash({onSuccess:function(){t=n.query("stat")[0],t&&t.value&&(e.stat=t.value,e.send("f_stats_show="+t.value,!0))}})},setStat:function(t,e){var n=this,a=n.get("caller"),i=a.query,r=n.saveQuery(i,t);r&&n.send("lf_aclog=null-null-null-null-0&stats_click="+r,e)},getStatInst:function(){var t=this,e=t.get("caller"),n=e.get("sugConfig"),a=n.tab||"",r=new i({name:"stat",tab:a});return r},saveQuery:function(t,e){var n,a,i=this.getStatInst();return e&&t?(n=encodeURIComponent(t),a="initiative_new:1;q:"+n,i.save("stat",a)):i.deleteItem("stat"),a},send:function(t,e){var n,a;e?(n="/tongji",a="H51884970"):(n="/search",a="H51884969"),(window.goldlog_queue||(window.goldlog_queue=[])).push({action:"goldlog.record",arguments:[n,"",t,a]})},renderPlugin:function(){}},{ATTRS:{pluginId:{value:"stat"}}}),r},{requires:["base","cookie","event","../mods/local-query"]});KISSY.add("tbc/search-suggest/1.4.7/mods/local-query",function(t,e,a,s,n){function i(t){i.superclass.constructor.call(this,t||{}),this.initialize()}var r="localQuery";return t.extend(i,e,{initialize:function(){var t=this,e=t.get("name"),a=t.get("tab"),s=t.get("user");"item"===a&&(a="baobei"),t.storageKey=r+e+a+s,t._getStorage()},checkFlash:function(t){this.storage.read(t)},_setKey:function(t){var e=this,a=t.name||e.get("name"),s=t.tab||e.get("tab"),n=t.user||e.get("user");"item"===s&&(s="baobei"),e.storageKey=r+a+s+n,e.set("tab",s),e.set("name",a),e.set("user",n),this.datalist=null},_save:function(e,a){if(!e.match(/<>'"/)&&!a.match(/<>'"/)){var s=this._getDatalist(),n=encodeURIComponent(e),i={key:n,value:encodeURIComponent(a),time:t.now()};this._deleteItemByValue(s,n),s.unshift(i)}},_deleteItemByValue:function(t,e){for(var a,s=null,n=0;n<t.length;n++)a=t[n].key,a==e&&(s=t.splice(n,1),n--)},_query:function(e){var a,s,n=this._getDatalist(),i=[];return e?(e=encodeURIComponent(e),t.each(n,function(t,n){a=t.key,s=t.value,(0===a.indexOf(e)||0===s.indexOf(e))&&i.push(t)}),this._distinctByValue(i)):this._distinctByValue(n)},_distinctByValue:function(t){for(var e,a=[],s=0,n=t.length;n>s;s++)e=t[s],e.value.match(/%3C|%3E|[<>'"]/g)||!this._hasItemOfValue(a,e.value)&&a.push(e);return a},_hasItemOfValue:function(t,e){for(var a=!1,s=t.length-1;s>=0;s--)t[s].value===e&&(a=!0);return a},_cleanBefore:function(t){for(var e,a=this._getDatalist(),s=0,n=a.length-1;n>=0;n--)if(e=a[n],e.time>t){s=n+1;break}a.length=s},_getDatalist:function(){return this.datalist||(this.datalist=this.storage.read()||[]),this.datalist},_getStorage:function(){var t=this.get("storageType");switch(t){case"flashStorage":this.storage=this._initFlashStorage();break;default:this.storage=!1}},_initFlashStorage:function(){var t=this;return{save:function(){return(new s).save(t.storageKey,a.stringify(t.datalist))},read:function(e){var i=(new s).read(t.storageKey,e);if(i){var r=a.parse(i);return r}return n}}},destructor:function(){this.datalist=null,r=null},save:function(e,a){if(""!=a){var s,n=this.storage.read();n&&(s=n.length);var i=this._save(e,a),r=this.storage.save();return s>300&&(this.datalist=this.datalist.slice(0,s-10),t.log("add_before\n"+r+"\n"+s),r=this.storage.save(),t.log("add_after\n"+r+"\n"+s)),i}},query:function(t){return this._query(t)},deleteItem:function(e){var a=this._getDatalist(),s=a.length;this._deleteItemByValue(a,encodeURIComponent(e));var n=this.storage.save();s>300&&(this.datalist=this.datalist.slice(0,s-10),n=this.storage.save(),t.log("delete\n"+n+"\n"+s))},clearByDay:function(e){var a=t.now()-24*e*3600*1e3;this._cleanBefore(a),this.storage.save()},hasHistory:function(){return this._getDatalist().length>0?!0:!1}},{ATTRS:{name:{value:"default",setter:function(t){return t}},user:{value:"",setter:function(e){return t.fromUnicode(e)}},maxLength:{value:500},storageType:{value:"flashStorage",setter:function(t){return t},getter:function(t){return t}}}}),i},{requires:["base","json","../mods/storage"]});/*! mini-login 2014-11-04 */
KISSY.add("tbc/mini-login/1.5.6/index",function(a,b,c,d,e){function f(){var a='<div id="J_LoginContainer" class="login-container" style="display:none" style="width:'+(D.width+2)+"px;height:"+(D.height+30)+'px">'+'<div class="login-wrapper">'+'<div class="login-hd">\u6dd8\u5b9d\u4f1a\u5458</div>'+'<div class="login-bd">'+'<iframe data-status="0" data-callbacked="0" frameborder="0" width="'+D.width+'" height="'+D.height+'" scrolling="no" id="'+I+'" name="'+J+'" src="about:blank" onload="_TBC_MiniLogin_Check()"></iframe>'+"</div>"+'<div class="login-ft">'+'<a class="login-close J_LoginClose" target="_self" title="\u5173\u95ed\u6b64\u7a97\u53e3" href="javascript:void(0)">\xd7</a>'+"</div>"+"</div>"+"</div>",c=b.create(a);return b.addStyleSheet(F),b.append(c,document.body),g(c),c}function g(a){c.on(a,"click",function(a){var c=a.target;b.hasClass(c,"J_LoginClose")&&m(function(){K.fire("close")})})}function h(a,b){a=a||"m";var c=e.get("_l_g_"),d=e.get("lgc"),f=e.get("sn");return b&&f?!0:"m"===a?!!c:"l"==a?!!d:void 0}function i(a,b){return z&&!h(a)?(b&&j(),!1):(d.getScript(B,function(){"undefined"!=typeof loginIndicator&&(loginIndicator.hasLoggedIn?n():b&&j())}),void 0)}function j(){var a,c,d=b.get("#J_LoginContainer");return p?(o(),void 0):(d||(d=f()),a=b.get("#"+I),c=y.build(A,{redirect_url:D.redirect_url,from:D.from,sub:x?!0:!1}),b.css(d,"display","block"),k(),b.attr(a,"data-status","0"),b.attr(a,"data-callbacked","0"),a.src=c,void 0)}function k(){l(),c.on(window,H,l)}function l(){var c,d,e=b.get("#J_LoginContainer");a.isObject(w)?(c=w.left||0,d=w.top||0):(c=parseInt(b.viewportWidth()/2)-parseInt(e.offsetWidth/2)+"px",d=(G?b.scrollTop():0)+parseInt(b.viewportHeight()/2)-parseInt(e.offsetHeight/2)+"px"),b.css(e,{top:d,left:c})}function m(a){var d=b.get("#J_LoginContainer");return d?(b.css(d,"display","none"),c.remove(window,H,l),a&&a(),void 0):!1}function n(){var a=b.get("#"+I);a&&"1"===b.attr(a,"data-callbacked")||(a&&b.attr(a,"data-callbacked","1"),m(function(){}),u&&u())}function o(){d.getScript(s+"mtb/lib-windvane/"+E+"/windvane.js",function(){try{WindVane.call("TBHDCommon","login",{},function(){u&&u(null)},function(a){u&&u(a)})}catch(a){window.location.assign("http://login.m.taobao.com/login.htm?tpl_redirect_url="+encodeURIComponent(window.location.href))}})}var p,q=a.unparam(location.search.slice(1))._login_daily_,r=q||-1!==location.host.indexOf(".daily."),s=r?"//assets.daily.taobao.net/g/":"//g.alicdn.com/";try{p=!!window.navigator.userAgent.match(/WindVane/i)}catch(t){}var u,v,w,x,y={getServer:function(a){var b,c,d=/\{(.+?)Server\}/i,e=d.exec(a);return e&&e[1]?(b=e[1],c=r?a.replace(d,"daily."+b+".net"):a.replace(d,b+".com")):c=a,c},build:function(b,c){var d=-1!==b.indexOf("?"),e=d?"&":"?";return a.isObject(c)?b+e+a.param(c):b+e+c}},z=/taobao|tmall/.test(location.host),A=y.getServer("https://login.{taobaoServer}/member/login.jhtml?style=mini&is_ignore=false"),B=y.getServer("http://buy.{taobaoServer}/auction/buy.htm?from=itemDetail"),C=window.g_config?g_config.loginCfg:{},D=a.merge({width:328,height:285,redirect_url:(r?"http://www.daily.taobao.net/":"http://www.taobao.com/")+"go/act/loginsuccess/taobao.php"},C||{}),E="1.4.6",F=".login-container{opacity:1;position:fixed;_position:absolute;z-index:100000000;background-color:#fafafa;padding:0;overflow:hidden;-moz-border-radius:3px;-webkit-border-radius:3px;border-radius:3px;border:3px solid #D5D5D5;}.login-container .login-wrapper{border:1px solid #aaa}.login-container .login-hd{height:35px;line-height:35px;padding-left:14px;font-weight:700;font-size:14px;margin-bottom:25px;background-color:#f2f2f2;}.login-container .login-ft{background-color:#F5F5F5;}.login-container .login-close{color:#9c9c97;font-family:Tahoma,sans;font-size:22px;position:absolute;right:8px;text-decoration:none;top:0;}",G=6===a.UA.ie,H=G?"scroll resize":"resize",I="J_LoginFrame",J="LoginFrame";window._TBC_MiniLogin_Check=function(){var a=b.get("#"+I),c=!1;if("0"===b.attr(a,"data-status"))b.attr(a,"data-status","1");else{try{href=win.frames[J].location.host,href?/login(?:\.daily)?\.taobao/.test(href)||n():c=!0}catch(d){c=!0}c&&("m"===v?i():h(v)&&n())}};var K,L=function(){};return a.augment(L,c.Target,{check:h,show:function(b,c){a.isFunction(b)?(c=b,type="m"):(b=a.isObject(b)?b:{type:a.isString(b)?b:"m"},type=b.type||"m",w=b.position,x=b.sub,E=b.windvane||E),v=type,u=c,"m"===type?i(type,!0):h(type,b.sub)?u&&u():j()},hide:function(){m()}}),K=new L},{requires:["dom","event","ajax","cookie","ua"]});