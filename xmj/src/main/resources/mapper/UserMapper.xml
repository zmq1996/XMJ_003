<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yc.xmj.mapper.UserMapper">
	<select id="getUser" parameterType="com.yc.xmj.entity.User" resultType="com.yc.xmj.entity.User">
	    select u_id,u_name,u_root from users where u_name=#{u_name} and  u_password = #{u_password}
	</select>
	
	<insert id="register" parameterType="com.yc.xmj.entity.User">
 		insert into users(u_id,u_name,u_password,u_phone,u_root,realNameAuthentication,payAuthentication)
 		 values(users_seq.nextval,#{u_name},#{u_password},#{u_phone},0,0,0)
 	</insert>
 	
 	<insert id="insertAddress" parameterType="com.yc.xmj.entity.User">
		<selectKey keyProperty="u_id" keyColumn="currval" resultType="int" order="BEFORE">
			select u_id currval from users where u_name = #{u_name} 
		</selectKey> 
		insert into ADDRESS values(address_seq.nextval,null,#{u_id},null,null)
	</insert>
 	
 	<insert id="insertShoppingBakcet" parameterType="com.yc.xmj.entity.User">
		<selectKey keyProperty="u_id" keyColumn="currval" resultType="int" order="BEFORE">
			select u_id currval from users where u_name = #{u_name} 
		</selectKey> 
		insert into shoppingBakcet values(shoppingBakcet_seq.nextval,#{u_id},null,null)
	</insert>
	
	<select id="getTrolley" parameterType="com.yc.xmj.entity.User" resultType="com.yc.xmj.entity.Trolley">
	    select sb.u_id,sb.sh_id,s_date,s_num,p_id,p_name,s_id,t_id,properties 
	    from shoppingbakcet sb join 
		(select sh_id,s_date,s_num,p.p_id,p_name,s_id,t_id,properties from shdetail st 
		join product p on st.p_id = p.p_id ) st
		on sb.sh_id = st.sh_id and u_id = #{u_id}
	</select>
</mapper>